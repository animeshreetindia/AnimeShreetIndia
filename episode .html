<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anime Detail</title>

<style>
body{margin:0;font-family:Arial;background:black;color:white}
.header{padding:10px;background:#111;text-align:center;color:red}
.poster{width:100%;max-height:350px;object-fit:cover}
.box{padding:15px}
.btn{display:block;margin:10px 0;padding:10px;background:red;color:white;text-align:center;border-radius:8px;text-decoration:none}
.ep{border:1px solid red;padding:10px;margin:8px 0;border-radius:8px}
</style>
</head>

<body>

<div class="header" id="title">Loading...</div>
<img id="poster" class="poster">

<div class="box">
<p id="info"></p>
<p id="desc"></p>

<h3>Episodes</h3>
<div id="episodeList"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyDCS8ijIYoQ3Ho4nduNOs9XmYQtjeT9Jc0",
  authDomain: "animeshreet.firebaseapp.com",
  projectId: "animeshreet"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.firestore();

let params = new URLSearchParams(window.location.search);
let animeName = params.get("name");

let animeData=null;

/* LOAD ANIME */
db.collection("anime").where("name","==",animeName)
.onSnapshot(snap=>{
  snap.forEach(doc=>{
    animeData = doc.data();
    showAnime();
  });
});

/* LOAD EPISODES */
db.collection("episodes").where("anime","==",animeName)
.onSnapshot(snap=>{
  let list=document.getElementById("episodeList");
  list.innerHTML="";
  snap.forEach(doc=>{
    let e=doc.data();
    list.innerHTML+=`
      <div class="ep">
        <b>${e.title}</b><br>
        <a class="btn" href="${e.link1}" target="_blank">Server 1</a>
        <a class="btn" href="${e.link2}" target="_blank">Server 2</a>in
        <a class="btn" href="${e.link3}" target="_blank">Server 3</a>
      </div>
    `;
  });
});

function showAnime(){
  document.getElementById("title").innerText = animeData.name;
  document.getElementById("poster").src = animeData.img;
  document.getElementById("info").innerText =
    animeData.genre+" | "+animeData.lang+" | "+animeData.type;
  document.getElementById("desc").innerText = animeData.desc;
}
</script>

</body>
</html>
