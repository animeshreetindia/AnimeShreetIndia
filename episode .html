<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Watch Anime</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:linear-gradient(#000,#111);
  color:white;
  font-family:Arial;
  padding:10px
}

h2{text-align:center;color:#00ffff}

.poster{
  width:100%;
  border-radius:12px;
  margin:10px 0;
}

.box{
  border:2px solid #ff004c;
  border-radius:10px;
  padding:10px;
  margin:10px 0;
  background:#111;
}

.ep{
  border:2px solid cyan;
  border-radius:12px;
  padding:10px;
  margin:12px 0;
  background:#0b0b0b;
}

.btn{
 display:inline-block;
 padding:10px 14px;
 border-radius:8px;
 margin:5px;
 color:white;
 text-decoration:none;
 font-weight:bold;
}
.download{background:red}

iframe{
  width:100%;
  height:200px;
  border-radius:12px;
  border:none;
  margin-top:10px;
}
</style>
</head>

<body>

<h2 id="animeTitle">Anime</h2>

<img id="photo" class="poster">

<div id="details" class="box"></div>

<h3 style="color:cyan">Episodes</h3>
<div id="episodeList"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyDCS8ijIYoQ3Ho4nduNOs9XmYQtjeT9Jc0",
  authDomain: "animeshreet.firebaseapp.com",
  projectId: "animeshreet"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.firestore();

const params = new URLSearchParams(window.location.search);
const animeName = decodeURIComponent(params.get("name") || "");

document.getElementById("animeTitle").innerText = animeName;

let currentAnimeId = "";

/* LOAD ANIME DETAILS */
db.collection("anime").where("name","==",animeName).get().then(snap=>{
 snap.forEach(doc=>{
  currentAnimeId = doc.id;
  let a = doc.data();
  photo.src = a.photo || "";

  details.innerHTML = `
   <b>Season:</b> ${a.season||""}<br>
   <b>Year:</b> ${a.year||""}<br>
   <b>Language:</b> ${a.lang||""}<br>
   <b>Genre:</b> ${a.genre||""}<br>
   <b>Description:</b> ${a.desc||""}
  `;
 });
});

/* LOAD EPISODES */
db.collection("episodes").onSnapshot(snap=>{
 episodeList.innerHTML="";
 snap.forEach(doc=>{
  let e = doc.data();

  if(e.animeId === currentAnimeId){
   episodeList.innerHTML += `
    <div class="ep">
      <h4>Episode: ${e.epName}</h4>

      <iframe src="${e.watch}" allowfullscreen></iframe>

      <a href="${e.download}" class="btn download" target="_blank">â¬‡ Download</a>
    </div>
   `;
  }
 });
});
</script>

</body>
</html>
